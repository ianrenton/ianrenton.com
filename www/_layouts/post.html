---
layout: default
---

{% capture threshold %}{{'2009-10-15 00:00:00 +0000' | date: '%s'}}{% endcapture %}
{% capture pagedate %}{{page.date | date: '%s'}}{% endcapture %}

<div class="post">

  <header class="post-header">
    {% comment %} If the post is in a collection, display the collection name as a link above post title {% endcomment %}
    {% if page.collection != nil %}
      {% assign thispagecollection = site.collections | where: "label", page.collection | first %}
      <h3><a href="{{ thispagecollection.collectionindex }}">{{ thispagecollection.collectiontitle }}:</a></h3>
    {% endif %}
    <h1 class="post-title">{{ page.title }}</h1>
    <p class="post-meta">{{ page.date | date: "Written on %A %-d %B %Y" }}</p>
  </header>

  {% comment %} If old post and no collection (i.e. a blog post) display a warning {% endcomment %}
  {% if pagedate < threshold and page.collection == nil %}
    <div class="oldwarning"><p>This is a very old post that was automatically imported from LiveJournal. I have done my best to fix up the formatting, but some issues may remain. Comments have not been preserved.</p></div>
  {% endif %}

  <article class="post-content">
    {{ content }}
  </article>

  {% if page.collection == nil %}
    {% comment %} If no collection (i.e. a blog post) look for previous/next posts the normal way {% endcomment %}
    {% assign prevurl = page.previous.url %}
    {% assign prevtitle = page.previous.title %}
    {% assign nexturl = page.next.url %}
    {% assign nexttitle = page.next.title %}
  {% elsif thispagecollection.showprevnext == true %}
    {% comment %} If in a collection, and the collection is tagged to have prev/next links at the bottom of posts, look for previous/next posts inside the collection, the complicated way {% endcomment %}

    {% for link in site[page.collection]  %}
      {% if link.title == page.title %}

        {% unless forloop.first %}
            {% assign prevurl = prev.url %}
            {% assign prevtitle = prev.title %}
        {% endunless %}

        {% unless forloop.last %}
            {% assign next = site[page.collection][forloop.index] %}
            {% assign nexturl = next.url %}
            {% assign nexttitle = next.title %}
        {% endunless %}
      {% endif %}

    {% assign prev = link %}
    {% endfor %}
  {% endif %}

  {% comment %} If we got previous/next post links via either means, display pagination {% endcomment %}
  {% if prevurl or nexturl %}
    <div class="pagination">
      <div class="pagination-left">{% if prevurl %}<a href="{{prevurl}}">&laquo; Previous Post<br/>{{ prevtitle }}</a>{% endif %}</div>
      <div class="pagination-right">{% if nexturl %}<a href="{{nexturl}}">Next Post &raquo;<br/>{{ nexttitle }}</a>{% endif %}</div>
    </div>
  {% endif %}

  {% comment %} If in a collection (i.e. not a blog post) or a blog post newer than the "old post" threshold, show comments box {% endcomment %}
  {% if pagedate >= threshold or page.collection != nil %}{% include juvia.html %}{% endif %}

</div>
